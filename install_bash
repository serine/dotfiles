#! /bin/bash

# Check and remove all previous symlinks/files and replace with new ones

usage() {
  echo "Usage: $0 [command] <file>"
  echo ""
  echo "         H|h|help             show help"
  echo "         A|apply              apply new rc/conf files"
  echo "         S|set-ssh            set ssh agent link"
  echo ""
}

apply_confs() {

  mydots=("vim/vim" \
          "vim/vimrc" \
          "tmux/tmux.conf" \
          "bash/bashrc" \
          "bash/bashrc.d" \
          "bash/bash_profile" \
          "bash/profile" \
          "bash/inputrc" \
          "git/gitconfig")
  
  origin=`readlink -f $(dirname "${BASH_SOURCE[0]}")`
  
  for item in ${mydots[@]};
  do

    actual=".$(basename $item)"

    if [[ ! -L "$HOME/$actual" ]]
    then

      if [[ ! -d $HOME/dotfile.bak ]]
      then
        mkdir $HOME/dotfile.bak
      fi

      if [[ -f $HOME/dotfile.bak ]]
      then
        echo "ERROR: This shouldn't happend"
        exit 1
      fi

      echo "Moving $HOME/$actual $HOME/dotfiles.bak"
      mv "$HOME/$actual" "$HOME/dotfiles.bak/"

      echo "Linking $origin/$item $HOME/$actual"
      ln -s "$origin/$item" "$HOME/$actual"

    else

      echo "Linking $origin/$item $HOME/$actual"
      ln -sf "$origin/$item" "$HOME/$actual"

    fi
  done
}

case "$1" in
  (help|h|H)
    usage
    exit
    ;;
  (A|apply)
    do_cmd="archive"
    ;;
  *)
    usage
    exit
esac
